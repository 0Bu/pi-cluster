apiVersion: batch/v1
kind: CronJob
metadata:
  name: google-ddns-client
spec:
  schedule: {{ required "schedule" .Values.schedule | quote }}
  concurrencyPolicy: Replace
  successfulJobsHistoryLimit: 1
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: curlimages
            image: curlimages/curl
            imagePullPolicy: IfNotPresent
            command:
            - /bin/sh
            - -c
            args:
            - curl -sSf -o - -X POST --max-time {{ default 30 .Values.timeout }} -u '{{ required "username" .Values.username }}:{{ required "password" .Values.password }}' https://domains.google.com/nic/update?hostname={{ required "domain" .Values.domain }}
          restartPolicy: OnFailure
